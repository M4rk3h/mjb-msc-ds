---
title: "Jane Austen Example - Complete"
author: "Penny Holborn"
date: "1 December 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

First we must install the packages required that we have not utilised previously.
```{r}
install.packages("janeaustenr")
install.packages("tidytext")
install.packages("textdata")
```

Along with loading the relevant libraries.
```{r}
library(janeaustenr)
library(dplyr)
library(stringr)
library(tidytext)
library(ggplot2)
library(tidyr)
library(textdata)
```

The first step is to extract the the books from the library.
```{r}
original_books <- austen_books() %>%
  group_by(book) %>%
  mutate(linenumber = row_number(),
         chapter = cumsum(str_detect(text, regex("^chapter [\\divxlc]",
                ignore_case = TRUE)))) %>%
ungroup()

original_books
```

We then need to split the text into tokens.
```{r}
tidy_books <- original_books %>%
  unnest_tokens(word, text)
tidy_books
```

Once again we need to remove stop words from the data.
```{r}
data(stop_words)
tidy_books <- tidy_books %>%
  anti_join(stop_words)
```

Use the count function to identify the most common words. 
```{r}
tidy_books %>%
  count(word, sort = TRUE) 
```

Produce a plot of the all words which appear more then 600 times.
```{r}
tidy_books %>%
  count(word, sort = TRUE) %>%
  filter(n > 600) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  xlab(NULL) +
  coord_flip()
```

Review the sentiment lexicons in the tidyverse package.
```{r}
sentiments
```

Identify the most common Joy words in the Novel Emma.
```{r}
nrc_joy <- get_sentiments("nrc") %>% 
  filter(sentiment == "joy")

tidy_books %>%
  filter(book == "Emma") %>%
  inner_join(nrc_joy) %>%
  count(word, sort = TRUE)
```

Calculate the sentiment for each 80 page section in each of the books.
```{r}
jane_austen_sentiment <- tidy_books %>%
  inner_join(get_sentiments("bing")) %>%
  count(book, index = linenumber %/% 80, sentiment) %>%
  spread(sentiment, n, fill = 0) %>%
  mutate(sentiment = positive - negative)
```

Plot these sentiment scores for each section by book.
```{r}
ggplot(jane_austen_sentiment, aes(index, sentiment, fill = book)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~book, ncol = 2, scales = "free_x")
```


Filter on just the novel, Pride and Prejudice.
```{r}
pride_prejudice <- tidy_books %>% 
  filter(book == "Pride & Prejudice")

pride_prejudice
```

Look to compare the scores by the Bing and nrc lexicons utilised.
```{r}
bing_and_nrc <- bind_rows(pride_prejudice %>% 
      inner_join(get_sentiments("bing")) %>%
        mutate(method = "Bing et al."),
  pride_prejudice %>% 
      inner_join(get_sentiments("nrc") %>% 
        filter(sentiment %in% c("positive", "negative"))) %>%
        mutate(method = "NRC")) %>%
            count(method, index = linenumber %/% 80, sentiment) %>%
  spread(sentiment, n, fill = 0) %>%
  mutate(sentiment = positive - negative)
```

Produce a plot of this output
```{r}
 bing_and_nrc %>%
  ggplot(aes(index, sentiment, fill = method)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~method, ncol = 1, scales = "free_y")
```